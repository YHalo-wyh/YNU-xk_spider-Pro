# YNU选课助手 Pro

> Forked from [starwingChen/YNU-xk_spider](https://github.com/starwingChen/YNU-xk_spider)

云南大学选课辅助工具，支持课程监控、自动抢课、智能换课、微信推送等功能。

## 功能特性

- **纯 API 模式** - 无需浏览器，轻量高效
- **验证码自动识别** - 全程无需手动操作
- **课程浏览** - 多板块、搜索、筛选
- **多课程并发监控** - 独立线程，互不阻塞
- **智能换课** - 检测时间冲突，退旧选新
- **安全优先** - 幽灵余量防御、亡命回滚，保护已选课程
- **微信推送** - 余量提醒 + 抢课成功通知（Server酱）
- **Session 自动恢复** - 登录过期自动重登

## 快速开始

### 下载

从 [Releases](https://github.com/YHalo-wyh/YNU-xk_spider-Pro/releases) 下载最新版本。

### 注意事项

⚠️ **本工具目前只支持第二轮课程的选退，暂不支持跨专业课程、重修课程及辅修课程的选退。**

### 使用

1. 输入学号密码，点击登录
2. 选择课程类型，浏览或搜索课程
3. 点击「加入待抢」添加到监控列表
4. 点击「开始监控」，程序自动检测余量并抢课

## 微信推送（Server酱）

1. 访问 https://sct.ftqq.com/ 获取 SendKey
2. 在程序中勾选「微信通知」并填入 SendKey

## 从源码运行

```bash
git clone https://github.com/YHalo-wyh/YNU-xk_spider-Pro.git
cd YNU-xk_spider-Pro
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
python run_gui.py
```

## 免责声明

本工具仅供学习交流，使用产生的后果由用户自行承担。请遵守学校规定，合理使用。

## 免费声明

**注意：本工具的所有功能模块、服务内容及衍生资源，均为免费提供，严禁任何单位或个人以任何形式进行收费。**

## 更新日志

### v1.8.0 (2026.01.21)
- 新增：去掉原来的程序内监控守护逻辑，新增独立守护进程 (Watchdog)，拥有独立图标，全天候守护主程序
- 新增：进程保护机制，主程序崩溃/异常退出时自动重启并恢复监控
- 新增：日志系统升级，支持按日期轮转 (每天一个文件) + 自动清理 (保留7天)
- 新增：启动与崩溃可追溯，日志记录 PID、运行模式等关键信息
- 优化：亡命回滚持续时间从 5 分钟延长至 1 小时
- 优化：全局异常捕获，防止未知错误导致静默闪退
- 修复：打包环境下守护进程路径识别问题

### v1.7.0 (2026.01.18)
- 新增：自动识别学生校区功能，支持东陆校区和呈贡校区
- 新增：在状态栏显示当前校区信息
- 优化：课程查询和选课API自动使用正确的校区代码
- 优化：容错机制，API失败时默认使用呈贡校区

### v1.6.0 (2026.01.18)
- 新增：监控守护功能，程序崩溃或关闭时自动重启并恢复监控状态
- 新增：监控状态自动保存，重启后无缝继续监控
- 新增：程序图标（窗口标题栏 + 任务栏）
- 新增：崩溃日志记录，方便问题排查
- 优化：守护功能整合到主程序，无需单独启动守护进程

### v1.5.0 (2026.01.17)
- 新增：增强版健康检查系统，4层检测机制
- 新增：智能自动恢复，检测到卡死后自动诊断和修复
- 新增：实时监控状态报告和预警
- 新增：体育课程显示项目名称
- 修复：3小时卡死问题（Socket句柄泄漏 + GIL死锁）
- 修复：登录后闪退问题

### v1.4.0 (2026.01.17)
- 新增：独立的更新检查 Worker，避免阻塞 UI
- 优化：心跳信号发送频率，减少跨线程通信
- 优化：日志框性能，超过 500 行自动清理，避免长时间运行卡顿
- 优化：课程获取失败时显示"加载中"，3 次失败后才显示错误
- 修复：使用 Session 上下文管理器，避免连接泄漏
- 修复：移除 terminate() 暴力终止线程，改用断开信号策略

### v1.3.0 (2026.01.16)
- 新增：每次查询显示课程余量状态
- 新增：定期检测登录状态（每60秒）
- 优化：日志输出更清晰

### v1.2.0 (2026.01.16)
- 纯 API 架构重构
- 多课程并发监控
- 智能换课功能
- 安全优先：删除盲抢、幽灵余量防御、亡命回滚
- Server酱微信通知
- Session 过期自动重登

### v1.0.0-beta (2026.01.12)
- 初始版本

## 作者

- 当前维护: [YHalo-wyh](https://github.com/YHalo-wyh)
- 原项目: [starwingChen/YNU-xk_spider](https://github.com/starwingChen/YNU-xk_spider)

## 特别致谢

感谢 [starwingChen](https://github.com/starwingChen) 的原项目提供了基础框架和灵感。

## License

[MIT License](LICENSE)

